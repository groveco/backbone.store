<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: json-api-parser.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: json-api-parser.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/***
 * JsonApiParser.
 * @module
 */
import _ from 'underscore'
import {camelize, decamelize} from './camelcase-dash'

/**
 * @private
 * Parser that parses a resource in JSON API format to BackboneStore format.
 */
class JsonApiParser {
  /**
   * Parses a resource from JSON API format to BackboneStore format.
   * @param {object} resource - Data in JSON API format.
   * @returns {object} Data in BackboneStore format.
   */
  parse (resource) {
    let result = {}
    if (resource.attributes) {
      _.extend(result, resource.attributes)
    }
    result.id = resource.id
    result._type = resource.type
    if (resource.links &amp;&amp; resource.links.self) {
      result._self = resource.links.self
    }
    if (resource.relationships) {
      result.relationships = resource.relationships
    }

    return this._parseWithNames(result)
  }

  /**
   * Serializes a resource from BackboneStore format to JSON API format.
   * @param {object} obj - Data in BackboneStore format.
   * @returns {object} Data in JSON API format.
   */
  serialize (obj) {
    let result = {
      id: obj.id,
      type: obj._type,
      attributes: {}
    }
    if (obj._self) {
      result.links = {
        self: obj._self
      }
    }
    if (obj.relationships) {
      result.relationships = this._serializeWithNames(obj.relationships)
    }
    const serializedAttributes = this._serializeWithNames(obj)
    delete serializedAttributes.id
    _.extend(result.attributes, serializedAttributes)
    return result
  }

  _parseWithNames (obj) {
    return Object.keys(obj).reduce((result, key) => {
      let value = obj[key]
      let newKey = camelize(key)

      if (_.isArray(value)) {
        value = value.map(item => {
          if (_.isObject(item)) return this._parseWithNames(item)
          else return item
        })
      } else if (_.isObject(value)) {
        value = this._parseWithNames(value)
      }

      result[newKey] = value
      return result
    }, {})
  }

  _serializeWithNames (obj) {
    return Object.keys(obj).reduce((result, key) => {
      if (!_.contains(['relationships', '_type', '_self'], key)) {
        let value = obj[key]
        let newKey = decamelize(key)

        if (_.isArray(value)) {
          value = value.map(item => {
            if (_.isObject(item)) return this._serializeWithNames(item)
            else return item
          })
        } else if (_.isObject(value)) {
          value = this._serializeWithNames(value)
        }

        result[newKey] = value
      }
      return result
    }, {})
  }
}

export default JsonApiParser
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-internal-model.html">internal-model</a></li></ul><h3>Classes</h3><ul><li><a href="CollectionProxy.html">CollectionProxy</a></li><li><a href="ModelProxy.html">ModelProxy</a></li><li><a href="module.exports.html">exports</a></li><li><a href="Store.html">Store</a></li></ul><h3>Global</h3><ul><li><a href="global.html#_checkSerializeRequests">_checkSerializeRequests</a></li><li><a href="global.html#_http">_http</a></li><li><a href="global.html#_makeRequest">_makeRequest</a></li><li><a href="global.html#buildUrl">buildUrl</a></li><li><a href="global.html#isValidResourceIdentifier">isValidResourceIdentifier</a></li><li><a href="global.html#request">request</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Tue Feb 16 2021 22:59:08 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
